<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-10-17 周三 08:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MyBatis</title>
<meta name="generator" content="Org mode">
<meta name="author" content="某某人">
<link rel='stylesheet' href='/asset/common.css' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">MyBatis</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc7e8118">1. 历史背景</a>
<ul>
<li><a href="#orgcfdcc5f">1.1. 背景</a></li>
<li><a href="#orga2a5e72">1.2. Hibernate</a></li>
<li><a href="#orgb70426b">1.3. MyBatis</a></li>
</ul>
</li>
<li><a href="#org3fe004e">2. 核心配置文件 (mybatis-config.xml)</a>
<ul>
<li><a href="#org815386e">2.1. 配置文件示例</a></li>
<li><a href="#orgc6f40cd">2.2. TypeHandler 示例</a></li>
<li><a href="#orge0efe68">2.3. ObjectFactory 示例</a></li>
<li><a href="#org38de6b2">2.4. DataSourceFactory 示例</a></li>
<li><a href="#org2f3b0f4">2.5. Plugin 示例</a></li>
</ul>
</li>
<li><a href="#orgc49e1a0">3. 映射文件 (EntityMapper.xml)</a></li>
<li><a href="#orga9abbb7">4. 常用 API</a></li>
<li><a href="#orgedb8f02">5. 示例表</a></li>
<li><a href="#org80db176">6. 任务指导手册 P58 答案参考</a>
<ul>
<li><a href="#org3bbd286">6.1. 首先，在数据库中创建表，并插入测试数据:</a></li>
<li><a href="#orgdf022c2">6.2. 其次，为表创建相应实体类:</a></li>
<li><a href="#org7dcda7a">6.3. 然后，创建接口。按照需求，我们要实现两个方法:</a></li>
<li><a href="#org0c2f814">6.4. 为上述接口，写测试方法:</a></li>
<li><a href="#orge9a53da">6.5. Mapper 的第一种方式，Nested ResultMap:</a></li>
<li><a href="#org894073d">6.6. Mapper 的第二种方式，Nested Select:</a></li>
</ul>
</li>
<li><a href="#org2070eee">7. 缓存 (Cache)</a></li>
<li><a href="#org4851433">8. 分页 (Pagination)</a></li>
<li><a href="#orgd61a2c2">9. MBG (MyBatis-Generator)</a></li>
</ul>
</div>
</nav>


<section id="outline-container-orgc7e8118" class="outline-2">
<h2 id="orgc7e8118"><span class="section-number-2">1</span> 历史背景</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgcfdcc5f" class="outline-3">
<h3 id="orgcfdcc5f"><span class="section-number-3">1.1</span> 背景</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>SSH, Spring + Struts1,2 + Hibernate</li>
<li>SSM, Spring + SpringMVC + MyBatis</li>
</ul>

<p>
dao, 数据库连接
</p>

<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> (id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> <span class="org-type">varchar</span>(20), weixin <span class="org-type">varchar</span>(20));
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person (<span class="org-keyword">name</span>, weixin) <span class="org-keyword">values</span> (<span class="org-string">'&#24352;&#23398;&#21451;'</span>, <span class="org-string">'110'</span>), (<span class="org-string">'&#21016;&#20134;&#33778;'</span>, <span class="org-string">'220'</span>);
</pre>
</div>

<p>
jdbc:
</p>
<ul class="org-ul">
<li>自行管理连接，语法比较繁琐</li>
<li>容易写出不健壮的代码</li>
<li>容易忽略业务逻辑</li>
</ul>

<p>
ORM:
</p>
<ul class="org-ul">
<li>Object-Relational Mapping</li>
</ul>


<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Person</span> {
    <span class="org-keyword">private</span> <span class="org-type">int</span> <span class="org-variable-name">id</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">name</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">weixin</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">getter..setter</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orga2a5e72" class="outline-3">
<h3 id="orga2a5e72"><span class="section-number-3">1.2</span> Hibernate</h3>
<div class="outline-text-3" id="text-1-2">
<p>
想法:
</p>
<ol class="org-ol">
<li>助手，读取数据库，获取相关的类，建立一种映射关系。session</li>
<li><p>
使用助手操作数据库:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-type">Book</span> <span class="org-variable-name">book</span> = <span class="org-keyword">new</span> <span class="org-type">Book</span>(<span class="org-string">"hhhh"</span>, 222);
session.save(book);

<span class="org-type">Book</span> <span class="org-variable-name">book1</span> = session.get(2L, Book.<span class="org-keyword">class</span>);
System.out.println(book1.getName());
</pre>
</div></li>
</ol>

<p>
示例，首先，在项目中添加依赖:
</p>
<div class="org-src-container">
<pre class="src src-sgml">&lt;<span class="org-function-name">dependency</span>&gt;
  &lt;<span class="org-function-name">groupId</span>&gt;org.hibernate&lt;/<span class="org-function-name">groupId</span>&gt;
  &lt;<span class="org-function-name">artifactId</span>&gt;hibernate-core&lt;/<span class="org-function-name">artifactId</span>&gt;
  &lt;<span class="org-function-name">version</span>&gt;5.3.6.Final&lt;/<span class="org-function-name">version</span>&gt;
&lt;/<span class="org-function-name">dependency</span>&gt;

&lt;<span class="org-function-name">dependency</span>&gt;
  &lt;<span class="org-function-name">groupId</span>&gt;org.mariadb.jdbc&lt;/<span class="org-function-name">groupId</span>&gt;
  &lt;<span class="org-function-name">artifactId</span>&gt;mariadb-java-client&lt;/<span class="org-function-name">artifactId</span>&gt;
  &lt;<span class="org-function-name">version</span>&gt;2.3.0&lt;/<span class="org-function-name">version</span>&gt;
&lt;/<span class="org-function-name">dependency</span>&gt;
</pre>
</div>

<p>
其次，创建配置文件 hibernate.cfg.xml:
</p>
<div class="org-src-container">
<pre class="src src-sgml"><span class="org-string">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span>
<span class="org-string">&lt;!DOCTYPE hibernate-configuration PUBLIC</span>
<span class="org-string"> "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
<span class="org-string"> "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;</span>

&lt;<span class="org-function-name">hibernate-configuration</span>&gt;
  &lt;<span class="org-function-name">session-factory</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.driver_class"</span>&gt;org.mariadb.jdbc.Driver&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.url"</span>&gt;jdbc:mariadb://localhost:3306/lagou&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.username"</span>&gt;vip&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.password"</span>&gt;vip&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.dialect"</span>&gt;org.hibernate.dialect.MariaDB10Dialect&lt;/<span class="org-function-name">property</span>&gt;

    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.show_sql"</span>&gt;true&lt;/<span class="org-function-name">property</span>&gt;

    &lt;<span class="org-function-name">mapping</span> <span class="org-variable-name">class</span>=<span class="org-string">"com.nf147.sss.entity.Person"</span> /&gt;
  &lt;/<span class="org-function-name">session-factory</span>&gt;
&lt;/<span class="org-function-name">hibernate-configuration</span>&gt;
</pre>
</div>

<p>
然后，创建 entity:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Entity</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Person</span> {
    <span class="org-c-annotation">@Id</span>
    <span class="org-c-annotation">@GeneratedValue</span>(strategy = <span class="org-constant">GenerationType</span>.IDENTITY)
    <span class="org-keyword">private</span> <span class="org-type">Long</span> <span class="org-variable-name">id</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">name</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">weixin</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">getter..setter</span>
}
</pre>
</div>

<p>
之后，就可以使用了:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>( <span class="org-type">String</span>[] <span class="org-variable-name">args</span> )
{
    <span class="org-type">Configuration</span> <span class="org-variable-name">configuration</span> = <span class="org-keyword">new</span> <span class="org-type">Configuration</span>();
    <span class="org-type">Configuration</span> <span class="org-variable-name">configure</span> = configuration.configure(<span class="org-string">"hibernate.cfg.xml"</span>);
    <span class="org-type">SessionFactory</span> <span class="org-variable-name">sessionFactory</span> = configuration.buildSessionFactory();

    <span class="org-type">Session</span> <span class="org-variable-name">session</span> = sessionFactory.openSession();
    <span class="org-type">Person</span> <span class="org-variable-name">person</span> = session.get(Person.<span class="org-keyword">class</span>, 1L);
    System.out.println(person.getName());

    System.out.println(session.get(Person.<span class="org-keyword">class</span>, 2L).getName());

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#26032;&#22686;</span>
    <span class="org-type">Person</span> <span class="org-variable-name">fbb</span> = <span class="org-keyword">new</span> <span class="org-type">Person</span>();
    fbb.setName(<span class="org-string">"fanbingbing"</span>);
    fbb.setWeixin(<span class="org-string">"80000000000"</span>);
    session.save(fbb);

    session.close();
    sessionFactory.close();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb70426b" class="outline-3">
<h3 id="orgb70426b"><span class="section-number-3">1.3</span> MyBatis</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>select id, name, wexin from person where ?</li>
<li>delete from person where id = ?</li>
<li>update person set..</li>
</ul>

<p>
给常用的语句，每个语句，起个名字。
</p>
<div class="org-src-container">
<pre class="src src-sgml">&lt;<span class="org-function-name">yujus</span>&gt;
  &lt;<span class="org-function-name">yuju</span> <span class="org-variable-name">name</span>=<span class="org-string">"yuju1"</span>&gt;
    select * from person
  &lt;/<span class="org-function-name">yuju</span>&gt;

  &lt;<span class="org-function-name">yuju</span> <span class="org-variable-name">name</span>=<span class="org-string">"yuju2"</span>&gt;
    delete from person
  &lt;/<span class="org-function-name">yuju</span>&gt;
&lt;/<span class="org-function-name">juyus</span>&gt;
</pre>
</div>

<p>
使用一个帮手，帮我们做事情:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-type">Helper</span> <span class="org-variable-name">helper</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">&#36825;&#20010;&#23601;&#26159;&#25105;&#20204;&#35831;&#30340;&#24110;&#25163;&#65292;&#23427;&#33021;&#22815;&#24110;&#25105;&#20204;&#36830;&#25509;&#12289;&#20851;&#38381;&#25968;&#25454;&#24211;&#65292;&#33021;&#22815;&#24110;&#25105;&#20204;&#36827;&#34892;&#25968;&#25454;&#24211;&#30340;&#26597;&#35810;</span>

<span class="org-type">Person</span> <span class="org-variable-name">person</span> = (<span class="org-type">Person</span>) helper.help(<span class="org-string">"yuju1"</span>);
helper.help(<span class="org-string">"yuju2"</span>);
</pre>
</div>

<p>
三件事:
</p>
<ol class="org-ol">
<li>语句</li>
<li>传入参数</li>
<li>返回值</li>
</ol>
</div>
</div>
</section>

<section id="outline-container-org3fe004e" class="outline-2">
<h2 id="org3fe004e"><span class="section-number-2">2</span> 核心配置文件 (mybatis-config.xml)</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org815386e" class="outline-3">
<h3 id="org815386e"><span class="section-number-3">2.1</span> 配置文件示例</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-sgml"><span class="org-string">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="org-string">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span>

&lt;<span class="org-function-name">configuration</span>&gt;
  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#23450;&#20041;&#21464;&#37327;&#65292;&#29992;&#20110;&#22797;&#29992;&#12305;</span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#21487;&#20197;&#36890;&#36807;&#22806;&#37096;&#25991;&#20214;&#21152;&#36733;&#21464;&#37327;&#65292;&#20063;&#21487;&#20197;&#30452;&#25509;&#36890;&#36807; property &#23450;&#20041; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">properties</span> <span class="org-variable-name">resource</span>=<span class="org-string">"jdbc.properties"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"password"</span> <span class="org-variable-name">value</span>=<span class="org-string">"vvvvvip"</span> /&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hello"</span> <span class="org-variable-name">value</span>=<span class="org-string">"world"</span> /&gt;
  &lt;/<span class="org-function-name">properties</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#20869;&#37096;&#35774;&#32622;&#12305;</span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#36890;&#36807;&#20462;&#25913;&#36825;&#20123;&#21442;&#25968;&#65292;&#26356;&#25913; Mybatis &#30340;&#20869;&#22312;&#34892;&#20026; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">settings</span>&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"multipleResultSetsEnabled"</span> <span class="org-variable-name">value</span>=<span class="org-string">"true"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"useColumnLabel"</span> <span class="org-variable-name">value</span>=<span class="org-string">"true"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"useGeneratedKeys"</span> <span class="org-variable-name">value</span>=<span class="org-string">"false"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"autoMappingBehavior"</span> <span class="org-variable-name">value</span>=<span class="org-string">"PARTIAL"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"autoMappingUnknownColumnBehavior"</span> <span class="org-variable-name">value</span>=<span class="org-string">"WARNING"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"defaultExecutorType"</span> <span class="org-variable-name">value</span>=<span class="org-string">"SIMPLE"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"defaultStatementTimeout"</span> <span class="org-variable-name">value</span>=<span class="org-string">"25"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"defaultFetchSize"</span> <span class="org-variable-name">value</span>=<span class="org-string">"100"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"safeRowBoundsEnabled"</span> <span class="org-variable-name">value</span>=<span class="org-string">"false"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"mapUnderscoreToCamelCase"</span> <span class="org-variable-name">value</span>=<span class="org-string">"false"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"jdbcTypeForNull"</span> <span class="org-variable-name">value</span>=<span class="org-string">"OTHER"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"cacheEnabled"</span> <span class="org-variable-name">value</span>=<span class="org-string">"true"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"lazyLoadingEnabled"</span> <span class="org-variable-name">value</span>=<span class="org-string">"true"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"localCacheScope"</span> <span class="org-variable-name">value</span>=<span class="org-string">"SESSION"</span>/&gt;
    &lt;<span class="org-function-name">setting</span> <span class="org-variable-name">name</span>=<span class="org-string">"lazyLoadTriggerMethods"</span> <span class="org-variable-name">value</span>=<span class="org-string">"equals,clone,hashCode,toString"</span>/&gt;
  &lt;/<span class="org-function-name">settings</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#35774;&#32622;&#21035;&#21517;&#12305;&#21487;&#20197;&#31616;&#21270;&#22312; xml &#20013;&#30340;&#23436;&#20840;&#38480;&#23450;&#21517;&#30340;&#20351;&#29992; </span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#36890;&#36807; package &#26041;&#24335;&#65292;&#21487;&#20197;&#31616;&#21270;&#20889;&#27861; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">typeAliases</span>&gt;
    <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;typeAlias alias="Author" type="com.nf147.sss.entity.Author"/&gt;</span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;typeAlias alias="Blog" type="com.nf147.sss.entity.Blog"/&gt;</span><span class="org-comment-delimiter">--&gt;</span>
    <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;typeAlias alias="Comment" type="com.nf147.sss.entity.Comment"/&gt;</span><span class="org-comment-delimiter">--&gt;</span>
    &lt;<span class="org-function-name">package</span> <span class="org-variable-name">name</span>=<span class="org-string">"com.nf147.sss.entity"</span> /&gt; <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#21487;&#20197;&#36319; @Alias &#32467;&#21512;&#20351;&#29992; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;/<span class="org-function-name">typeAliases</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#31867;&#22411;&#22788;&#29702;&#22120;&#12305;</span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">MyBatis &#24050;&#32463;&#20869;&#32622;&#20102;&#22810;&#25968;&#30340;&#31867;&#22411;&#22788;&#29702;&#22120;&#65292;&#33021;&#24212;&#20184;&#32477;&#22823;&#22810;&#25968;&#30340;&#31867;&#22411;&#36716;&#25442; </span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#22914;&#26524;&#25105;&#20204;&#26377;&#29305;&#23450;&#30340;&#38656;&#27714;&#65292;&#21487;&#20197;&#23450;&#20041;&#33258;&#24049;&#30340;&#22788;&#29702;&#22120;(&#23454;&#29616; TypeHandler &#25509;&#21475;&#25110;&#32487;&#25215;&#30456;&#20851;&#23454;&#29616;&#31867;) </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">typeHandlers</span>&gt;
    <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;typeHandler handler="com.nf147.sss.handler.FakeIntegerHandler" /&gt;</span><span class="org-comment-delimiter">--&gt;</span>
    &lt;<span class="org-function-name">package</span> <span class="org-variable-name">name</span>=<span class="org-string">"com.nf147.sss.handler"</span> /&gt;
  &lt;/<span class="org-function-name">typeHandlers</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#23454;&#20363;&#21270;&#32467;&#26524;&#23545;&#35937;&#12305;</span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#40664;&#35748;&#20351;&#29992; DefaultObjectFactory &#26469;&#23454;&#20363;&#21270;&#32467;&#26524;&#23545;&#35937;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#23450;&#20041;&#33258;&#24049;&#30340;&#65292;&#35206;&#30422;&#21407;&#26469;&#30340; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">objectFactory</span> <span class="org-variable-name">type</span>=<span class="org-string">"com.nf147.sss.handler.OurObjectFactory"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"someProperty"</span> <span class="org-variable-name">value</span>=<span class="org-string">"100"</span>/&gt;
  &lt;/<span class="org-function-name">objectFactory</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#25554;&#20214;&#12305;&#29992;&#26469;&#25318;&#25130;&#24182;&#25913;&#21464; MyBatis &#30340;&#24037;&#20316;&#27969; </span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#23427;&#26412;&#36136;&#23601;&#26159;&#19968;&#20010;&#25318;&#25130;&#22120; </span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#23450;&#20041;&#25554;&#20214;&#65292;&#38656;&#35201;&#23454;&#29616; Interceptor &#25509;&#21475;&#21363;&#21487; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">plugins</span>&gt;
    &lt;<span class="org-function-name">plugin</span> <span class="org-variable-name">interceptor</span>=<span class="org-string">"com.nf147.sss.plugin.MyPlugin"</span>&gt;
      &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"msg"</span> <span class="org-variable-name">value</span>=<span class="org-string">"hello, world"</span>/&gt;
      &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"dbtype"</span> <span class="org-variable-name">value</span>=<span class="org-string">"mysql"</span> /&gt;
    &lt;/<span class="org-function-name">plugin</span>&gt;
  &lt;/<span class="org-function-name">plugins</span>&gt;

  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#12304;&#37197;&#32622;&#36830;&#25509;&#29615;&#22659;&#12305;</span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#21487;&#20197;&#37197;&#32622;&#22810;&#20010;&#65292;&#27599;&#19968;&#20010;&#38656;&#35201;&#37197;&#32622;&#20004;&#37096;&#20998;: &#20107;&#21153; + &#25968;&#25454;&#28304; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">environments</span> <span class="org-variable-name">default</span>=<span class="org-string">"prod"</span>&gt;
    &lt;<span class="org-function-name">environment</span> <span class="org-variable-name">id</span>=<span class="org-string">"dev"</span>&gt;
      &lt;<span class="org-function-name">transactionManager</span> <span class="org-variable-name">type</span>=<span class="org-string">"JDBC|MANAGED"</span> /&gt;
      &lt;<span class="org-function-name">dataSource</span> <span class="org-variable-name">type</span>=<span class="org-string">"UNPOOLED|POOLED|JNDI|com.nf147.sss.ds.MyDataSource"</span>&gt;
        &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"driver"</span> <span class="org-variable-name">value</span>=<span class="org-string">"${driver}"</span>/&gt;
        &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"url"</span> <span class="org-variable-name">value</span>=<span class="org-string">"${url}"</span>/&gt;
        &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"username"</span> <span class="org-variable-name">value</span>=<span class="org-string">"${username}"</span>/&gt;
        &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"password"</span> <span class="org-variable-name">value</span>=<span class="org-string">"${password}"</span>/&gt;
      &lt;/<span class="org-function-name">dataSource</span>&gt;
    &lt;/<span class="org-function-name">environment</span>&gt;
  &lt;/<span class="org-function-name">environments</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#22810;&#25968;&#25454;&#26631;&#35782;&#12305;&#29992;&#20110;&#22312; MyBatis &#20013;&#20351;&#29992;&#22810;&#25968;&#25454;&#24211;&#35821;&#21477; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">databaseIdProvider</span> <span class="org-variable-name">type</span>=<span class="org-string">"DB_VENDOR"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"MySQL"</span> <span class="org-variable-name">value</span>=<span class="org-string">"my"</span>/&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"SQL Server"</span> <span class="org-variable-name">value</span>=<span class="org-string">"sqlserver"</span>/&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"DB2"</span> <span class="org-variable-name">value</span>=<span class="org-string">"db2"</span>/&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"Oracle"</span> <span class="org-variable-name">value</span>=<span class="org-string">"oracle"</span> /&gt;
  &lt;/<span class="org-function-name">databaseIdProvider</span>&gt;

  <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#12304;&#25351;&#23450;&#26144;&#23556;&#22120;&#12305;</span><span class="org-comment-delimiter">--&gt;</span>
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#26377;&#22914;&#19979;&#22235;&#31181;&#20889;&#27861; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">mappers</span>&gt;
    &lt;<span class="org-function-name">mapper</span> <span class="org-variable-name">resource</span>=<span class="org-string">"PersonMapper.xml"</span> /&gt;
    &lt;<span class="org-function-name">mapper</span> <span class="org-variable-name">url</span>=<span class="org-string">"d:/wenjian/de/weizhi/Person.xml"</span> /&gt;
    &lt;<span class="org-function-name">mapper</span> <span class="org-variable-name">class</span>=<span class="org-string">"com.nf147.sss.dao.CommonDAO"</span> /&gt;
    &lt;<span class="org-function-name">package</span> <span class="org-variable-name">name</span>=<span class="org-string">"mapper"</span> /&gt;
  &lt;/<span class="org-function-name">mappers</span>&gt;
&lt;/<span class="org-function-name">configuration</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6f40cd" class="outline-3">
<h3 id="orgc6f40cd"><span class="section-number-3">2.2</span> TypeHandler 示例</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@MappedJdbcTypes</span>(<span class="org-constant">JdbcType</span>.<span class="org-type">Integer</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">FakeIntegerHandler</span> <span class="org-keyword">extends</span> <span class="org-type">IntegerTypeHandler</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">setNonNullParameter</span>(<span class="org-type">PreparedStatement</span> <span class="org-variable-name">ps</span>, <span class="org-type">int</span> <span class="org-variable-name">i</span>, <span class="org-type">Integer</span> <span class="org-variable-name">parameter</span>, <span class="org-type">JdbcType</span> <span class="org-variable-name">jdbcType</span>) <span class="org-keyword">throws</span> <span class="org-type">SQLException</span> {
        ps.setInt(i, parameter * parameter);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0efe68" class="outline-3">
<h3 id="orge0efe68"><span class="section-number-3">2.3</span> ObjectFactory 示例</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">OurObjectFactory</span> <span class="org-keyword">extends</span> <span class="org-type">DefaultObjectFactory</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> &lt;<span class="org-type">T</span>&gt; <span class="org-type">T</span> <span class="org-function-name">create</span>(<span class="org-type">Class</span>&lt;<span class="org-type">T</span>&gt; <span class="org-variable-name">type</span>) {
        System.out.println(<span class="org-string">"&#25298;&#32477;&#37197;&#21512;"</span>);
        <span class="org-keyword">return</span> <span class="org-constant">null</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org38de6b2" class="outline-3">
<h3 id="org38de6b2"><span class="section-number-3">2.4</span> DataSourceFactory 示例</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MyDataSourceFactory</span> <span class="org-keyword">extends</span> <span class="org-type">UnpooledDataSourceFactory</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">MyDataSourceFactory</span>() {
        <span class="org-keyword">this</span>.dataSource = <span class="org-keyword">new</span> <span class="org-type">ComboPooledDataSource</span>();
        ((<span class="org-type">ComboPooledDataSource</span>) <span class="org-keyword">this</span>.dataSource).setCheckoutTimeout(30);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f3b0f4" class="outline-3">
<h3 id="org2f3b0f4"><span class="section-number-3">2.5</span> Plugin 示例</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Intercepts</span>({<span class="org-c-annotation">@Signature</span>(
  type= Executor.<span class="org-keyword">class</span>,
  method = <span class="org-string">"update"</span>,
  args = {MappedStatement.<span class="org-keyword">class</span>,Object.<span class="org-keyword">class</span>})})
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MyPlugin</span> <span class="org-keyword">implements</span> <span class="org-type">Interceptor</span> {
      <span class="org-keyword">public</span> <span class="org-type">Object</span> <span class="org-function-name">intercept</span>(<span class="org-type">Invocation</span> <span class="org-variable-name">invocation</span>) <span class="org-keyword">throws</span> <span class="org-type">Throwable</span> {
          System.out.println(<span class="org-string">"&#22312;&#36825;&#37324;&#65292;&#36827;&#34892;&#25318;&#25130;&#12289;&#20462;&#25913;"</span>);
          <span class="org-keyword">return</span> invocation.proceed();
      }
      <span class="org-keyword">public</span> <span class="org-type">Object</span> <span class="org-function-name">plugin</span>(<span class="org-type">Object</span> <span class="org-variable-name">target</span>) {
          <span class="org-keyword">return</span> Plugin.wrap(target, <span class="org-keyword">this</span>);
      }
      <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">setProperties</span>(<span class="org-type">Properties</span> <span class="org-variable-name">properties</span>) {
          System.out.println(properties.getProperty(<span class="org-string">"hello"</span>));
      }
  }
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-orgc49e1a0" class="outline-2">
<h2 id="orgc49e1a0"><span class="section-number-2">3</span> 映射文件 (EntityMapper.xml)</h2>
<div class="outline-text-2" id="text-3">
<p>
示例 XML:
</p>
<div class="org-src-container">
<pre class="src src-sgml"><span class="org-string">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="org-string">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>

&lt;<span class="org-function-name">mapper</span> <span class="org-variable-name">namespace</span>=<span class="org-string">"com.nf147.sss.dao.CommonDAO"</span>&gt;
    &lt;<span class="org-function-name">sql</span> <span class="org-variable-name">id</span>=<span class="org-string">"sql1"</span>&gt;&lt;/<span class="org-function-name">sql</span>&gt;

    &lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmAuthor"</span> <span class="org-variable-name">type</span>=<span class="org-string">"author"</span>&gt;
        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;id property="id" column="id" /&gt;</span><span class="org-comment-delimiter">--&gt;</span>
        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;result property="name" column="name" /&gt;</span><span class="org-comment-delimiter">--&gt;</span>
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"city"</span> <span class="org-variable-name">column</span>=<span class="org-string">"chengshi"</span> /&gt;
    &lt;/<span class="org-function-name">resultMap</span>&gt;

    &lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"selectAll"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmAuthor"</span>&gt;
        select
          id,
          name,
          chengshi
        from sss_author
    &lt;/<span class="org-function-name">select</span>&gt;

    &lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmBlog"</span> <span class="org-variable-name">type</span>=<span class="org-string">"blog"</span>&gt;
        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#22522;&#26412;&#30340;&#25968;&#25454;&#31867;&#22411;&#65292;&#20351;&#29992; id/result</span><span class="org-comment-delimiter">--&gt;</span>

        &lt;<span class="org-function-name">id</span> <span class="org-variable-name">property</span>=<span class="org-string">"id"</span> <span class="org-variable-name">column</span>=<span class="org-string">"id"</span> /&gt;
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"title"</span> <span class="org-variable-name">column</span>=<span class="org-string">"title"</span> /&gt;
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"content"</span> <span class="org-variable-name">column</span>=<span class="org-string">"content"</span> /&gt;

        <span class="org-comment-delimiter">&lt;!--</span>
<span class="org-comment">        &lt;constructor&gt;</span>
<span class="org-comment">            &lt;idArg column="id" javaType="int" /&gt;</span>
<span class="org-comment">            &lt;arg column="title" javaType="string" /&gt;</span>
<span class="org-comment">            &lt;arg column="content" javaType="string" /&gt;</span>
<span class="org-comment">        &lt;/constructor&gt;</span>
<span class="org-comment">        </span><span class="org-comment-delimiter">--&gt;</span>

        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">association &#34920;&#31034;&#30340;&#26159; has One &#30340;&#20851;&#31995;</span><span class="org-comment-delimiter">--&gt;</span>

        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#31532;&#19968;&#31181;&#26041;&#24335;&#65306;nested select</span><span class="org-comment-delimiter">--&gt;</span>
        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;association property="author" javaType="author"</span><span class="org-comment-delimiter">--&gt;</span>
            <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">column="aid" select="com.nf147.sss.dao.CommonDAO.selectAuthorById" /&gt;</span><span class="org-comment-delimiter">--&gt;</span>

        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&#31532;&#20108;&#31181;&#26041;&#24335;&#65292;nested resultMap</span><span class="org-comment-delimiter">--&gt;</span>
        <span class="org-comment-delimiter">&lt;!--</span>
<span class="org-comment">        &lt;association property="author" javaType="author"&gt;</span>
<span class="org-comment">            &lt;id property="id" column="author_id" /&gt;</span>
<span class="org-comment">            &lt;result property="name" column="author_name" /&gt;</span>
<span class="org-comment">            &lt;result property="city" column="author_city" /&gt;</span>
<span class="org-comment">        &lt;/association&gt;</span>
<span class="org-comment">        </span><span class="org-comment-delimiter">--&gt;</span>

        <span class="org-comment-delimiter">&lt;!--</span>
<span class="org-comment">        &lt;association property="author" javaType="author" columnPrefix="author_"&gt;</span>
<span class="org-comment">            &lt;id property="id" column="id" /&gt;</span>
<span class="org-comment">            &lt;result property="name" column="name" /&gt;</span>
<span class="org-comment">            &lt;result property="city" column="city" /&gt;</span>
<span class="org-comment">        &lt;/association&gt;</span>
<span class="org-comment">        </span><span class="org-comment-delimiter">--&gt;</span>

        &lt;<span class="org-function-name">association</span> <span class="org-variable-name">property</span>=<span class="org-string">"author"</span> <span class="org-variable-name">javaType</span>=<span class="org-string">"author"</span> <span class="org-variable-name">columnPrefix</span>=<span class="org-string">"author_"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"a2"</span> /&gt;


        <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">Collection &#34920;&#31034;&#30340;&#26159; Has Many &#30340;&#20851;&#31995;</span><span class="org-comment-delimiter">--&gt;</span>
        &lt;<span class="org-function-name">collection</span> <span class="org-variable-name">property</span>=<span class="org-string">"comments"</span> <span class="org-variable-name">ofType</span>=<span class="org-string">"comment"</span> <span class="org-variable-name">columnPrefix</span>=<span class="org-string">"comment_"</span>&gt;
            &lt;<span class="org-function-name">id</span> <span class="org-variable-name">property</span>=<span class="org-string">"id"</span> <span class="org-variable-name">column</span>=<span class="org-string">"id"</span> /&gt;
            &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"body"</span> <span class="org-variable-name">column</span>=<span class="org-string">"body"</span> /&gt;
        &lt;/<span class="org-function-name">collection</span>&gt;
    &lt;/<span class="org-function-name">resultMap</span>&gt;

    &lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"a2"</span> <span class="org-variable-name">type</span>=<span class="org-string">"author"</span>&gt;
        &lt;<span class="org-function-name">id</span> <span class="org-variable-name">property</span>=<span class="org-string">"id"</span> <span class="org-variable-name">column</span>=<span class="org-string">"id"</span> /&gt;
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"name"</span> <span class="org-variable-name">column</span>=<span class="org-string">"name"</span> /&gt;
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"city"</span> <span class="org-variable-name">column</span>=<span class="org-string">"city"</span> /&gt;
    &lt;/<span class="org-function-name">resultMap</span>&gt;

    <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">result type </span><span class="org-comment-delimiter">--&gt;</span>
    &lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"selectAuthorById"</span> <span class="org-variable-name">resultType</span>=<span class="org-string">"author"</span>&gt;
        select id, name, city from sss_author where id=#{id}
    &lt;/<span class="org-function-name">select</span>&gt;
    &lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"selectCommentsOfBlog"</span> <span class="org-variable-name">resultType</span>=<span class="org-string">"comment"</span>&gt;
        select id, body from sss_comment where blog_id = #{id}
    &lt;/<span class="org-function-name">select</span>&gt;

    <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">result map </span><span class="org-comment-delimiter">--&gt;</span>
    &lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"selectBlogs"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmBlog"</span>&gt;
        select
          b.id         as id,
          b.title      as title,
          b.content    as content,
          a.id         as author_id,
          a.name       as author_name,
          a.city       as author_city,
          c.id         as comment_id,
          c.body       as comment_body
        from
          sss_blog b
          left join sss_author a on b.author_id = a.id
          left join sss_comment c on c.blog_id = b.id
    &lt;/<span class="org-function-name">select</span>&gt;

    &lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"selectBlogsNestedSelect"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmBlogNestedSelect"</span>&gt;
        select
          id, title, content, author_id
        from
          sss_blog
    &lt;/<span class="org-function-name">select</span>&gt;

    &lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmBlogNestedSelect"</span> <span class="org-variable-name">type</span>=<span class="org-string">"blog"</span>&gt;
        &lt;<span class="org-function-name">id</span> <span class="org-variable-name">property</span>=<span class="org-string">"id"</span> <span class="org-variable-name">column</span>=<span class="org-string">"id"</span> /&gt;
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"title"</span> <span class="org-variable-name">column</span>=<span class="org-string">"title"</span> /&gt;
        &lt;<span class="org-function-name">result</span> <span class="org-variable-name">property</span>=<span class="org-string">"content"</span> <span class="org-variable-name">column</span>=<span class="org-string">"content"</span> /&gt;
        &lt;<span class="org-function-name">association</span> <span class="org-variable-name">property</span>=<span class="org-string">"author"</span> <span class="org-variable-name">javaType</span>=<span class="org-string">"author"</span>
                     <span class="org-variable-name">column</span>=<span class="org-string">"author_id"</span> <span class="org-variable-name">select</span>=<span class="org-string">"com.nf147.sss.dao.CommonDAO.selectAuthorById"</span> /&gt;
        &lt;<span class="org-function-name">collection</span> <span class="org-variable-name">property</span>=<span class="org-string">"comments"</span> <span class="org-variable-name">ofType</span>=<span class="org-string">"comment"</span>
                    <span class="org-variable-name">column</span>=<span class="org-string">"id"</span> <span class="org-variable-name">select</span>=<span class="org-string">"com.nf147.sss.dao.CommonDAO.selectCommentsOfBlog"</span> /&gt;
    &lt;/<span class="org-function-name">resultMap</span>&gt;


    <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">DML &#35821;&#21477; </span><span class="org-comment-delimiter">--&gt;</span>

    <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#20027;&#38190;&#31574;&#30053; </span><span class="org-comment-delimiter">--&gt;</span>
    &lt;<span class="org-function-name">insert</span> <span class="org-variable-name">id</span>=<span class="org-string">"insertAuthor"</span> <span class="org-variable-name">useGeneratedKeys</span>=<span class="org-string">"false"</span> <span class="org-variable-name">keyProperty</span>=<span class="org-string">"id"</span> <span class="org-variable-name">keyColumn</span>=<span class="org-string">"id"</span>&gt;
        &lt;<span class="org-function-name">selectKey</span> <span class="org-variable-name">keyProperty</span>=<span class="org-string">"id"</span> <span class="org-variable-name">resultType</span>=<span class="org-string">"int"</span> <span class="org-variable-name">order</span>=<span class="org-string">"BEFORE"</span>&gt;
            select floor(rand()*1000)
        &lt;/<span class="org-function-name">selectKey</span>&gt;
        insert into sss_author (id, name, city) values (#{id}, #{name}, #{city})
    &lt;/<span class="org-function-name">insert</span>&gt;
    &lt;<span class="org-function-name">update</span> <span class="org-variable-name">id</span>=<span class="org-string">"updateBlog"</span>&gt;
        update sss_blog set content = #{content} where id = #{id}
    &lt;/<span class="org-function-name">update</span>&gt;
    &lt;<span class="org-function-name">update</span> <span class="org-variable-name">id</span>=<span class="org-string">"updateBlog2"</span> <span class="org-variable-name">parameterType</span>=<span class="org-string">"blog"</span> <span class="org-variable-name">databaseId</span>=<span class="org-string">"oracle"</span>&gt;
        update sss_blog set content = #{content} where id = #{id} and 1=1
    &lt;/<span class="org-function-name">update</span>&gt;
    &lt;<span class="org-function-name">update</span> <span class="org-variable-name">id</span>=<span class="org-string">"updateBlog2"</span> <span class="org-variable-name">parameterType</span>=<span class="org-string">"blog"</span> <span class="org-variable-name">databaseId</span>=<span class="org-string">"mysql"</span>&gt;
        update sss_blog set content = #{content} where id = #{id}
    &lt;/<span class="org-function-name">update</span>&gt;
    &lt;<span class="org-function-name">update</span> <span class="org-variable-name">id</span>=<span class="org-string">"updateBlog3"</span> <span class="org-variable-name">statementType</span>=<span class="org-string">"CALLABLE"</span>&gt;
        update sss_blog set content = #{content} where id = #{id}
    &lt;/<span class="org-function-name">update</span>&gt;
    &lt;<span class="org-function-name">delete</span> <span class="org-variable-name">id</span>=<span class="org-string">"ddd"</span> /&gt;
&lt;/<span class="org-function-name">mapper</span>&gt;
</pre>
</div>

<p>
相关调用语句:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-type">CommonDAO</span> <span class="org-variable-name">mapper</span> = session.getMapper(CommonDAO.<span class="org-keyword">class</span>);
<span class="org-comment-delimiter">//        </span><span class="org-comment">List&lt;Author&gt; authors = mapper.findAll(new RowBounds(1, 3));</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">authors.forEach(System.out::println);</span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">List&lt;Author&gt; authors1 = mapper.findAllIdBiggerThan(3, new RowBounds(1, 2));</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">authors1.forEach(System.out::println);</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">System.out.println(mapper.findByNameAndCity("&#37101;&#25964;&#26126;' or 1=1 or name='xxx", "&#19978;&#28023;"));</span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">mapper.delOne("'1' or 1=1");</span>

<span class="org-comment-delimiter">//        </span><span class="org-comment">int ret = mapper.delThree("update sss_blog set content='&#20320;&#19981;&#26159;&#33485;&#34631;' ", 3);</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">session.commit();</span>

<span class="org-comment-delimiter">//        </span><span class="org-comment">Blog blog = new Blog();</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">blog.setId(3);</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">blog.setContent("&#25105;&#19981;&#30693;&#36947;&#33485;&#34631;&#22312;&#21738;&#37324;&#12290;");</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">System.out.println(mapper.updateBlog3(blog));</span>

<span class="org-comment-delimiter">//        </span><span class="org-comment">Author author = new Author();</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">author.setName("&#26361;&#38634;&#33465;22");</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">author.setCity("&#21271;&#20140;222");</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">mapper.insertAuthor(author);</span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">System.out.println(author.getId());</span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//        </span><span class="org-comment">session.commit();</span>

<span class="org-comment-delimiter">//        </span><span class="org-comment">mapper.selectAll().forEach(System.out::println);</span>

<span class="org-type">List</span>&lt;<span class="org-type">Blog</span>&gt; <span class="org-variable-name">blogs</span> = mapper.selectBlogs();
<span class="org-type">Blog</span> <span class="org-variable-name">blog</span> = blogs.get(0);
<span class="org-type">Author</span> <span class="org-variable-name">author</span> = blog.getAuthor();
<span class="org-type">List</span>&lt;<span class="org-type">Comment</span>&gt; <span class="org-variable-name">comments</span> = blog.getComments();
System.out.println(blog.getTitle());
System.out.println(author.getName());

System.out.println(comments);
</pre>
</div>
</div>
</section>

<section id="outline-container-orga9abbb7" class="outline-2">
<h2 id="orga9abbb7"><span class="section-number-2">4</span> 常用 API</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
    <span class="org-type">InputStream</span> <span class="org-variable-name">in</span> = Resources.getResourceAsStream(<span class="org-string">"mybatis-config.xml"</span>);
    <span class="org-type">SqlSessionFactory</span> <span class="org-variable-name">factory</span> = <span class="org-keyword">new</span> <span class="org-type">SqlSessionFactoryBuilder</span>().build(in);
    <span class="org-type">SqlSession</span> <span class="org-variable-name">session</span> = factory.openSession();

    <span class="org-comment-delimiter">// </span><span class="org-comment">selectOne</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">&#37325;&#36733;&#26377;&#20004;&#20010;&#26041;&#27861;&#65292;&#31532;&#20108;&#20010;&#26159;&#26465;&#20214;&#21442;&#25968;</span>
    <span class="org-type">Object</span> <span class="org-variable-name">o</span> = session.selectOne(<span class="org-string">"xxx.findById"</span>);
    <span class="org-type">Object</span> <span class="org-variable-name">o</span> = session.selectOne(<span class="org-string">"xxx.findById"</span>, 3);
    <span class="org-type">Object</span> <span class="org-variable-name">o</span> = session.selectOne(<span class="org-string">"xxx.findByName"</span>, <span class="org-string">"&#27611;%"</span>);
    <span class="org-type">Object</span> <span class="org-variable-name">o</span> = session.selectOne(<span class="org-string">"xxx.findByNameAndCity"</span>, <span class="org-keyword">new</span> <span class="org-type">HashMap</span>&lt;<span class="org-type">String</span>, <span class="org-type">String</span>&gt;() {{
        put(<span class="org-string">"name"</span>, <span class="org-string">"&#37101;&#25964;&#26126;"</span>);
        put(<span class="org-string">"city"</span>, <span class="org-string">"&#19978;&#28023;"</span>);
    }});
    <span class="org-type">Object</span> <span class="org-variable-name">o</span> = session.selectOne(<span class="org-string">"xxx.findByNameAndCity"</span>, <span class="org-keyword">new</span> <span class="org-type">Author</span>(<span class="org-string">"&#40065;&#36805;"</span>, <span class="org-string">"&#27993;&#27743;"</span>));

    <span class="org-comment-delimiter">// </span><span class="org-comment">selectList</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">&#32467;&#26524;&#23553;&#35013;&#20026; List</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">&#37325;&#36733;&#26377;&#19977;&#20010;&#26041;&#27861;</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">&#31532;&#19977;&#20010;&#21442;&#25968;&#65292;&#34920;&#31034;&#20998;&#39029; (RowBounds)</span>
    <span class="org-type">List</span>&lt;<span class="org-type">Object</span>&gt; <span class="org-variable-name">lst</span> = session.selectList(<span class="org-string">"findAll"</span>);
    <span class="org-type">List</span>&lt;<span class="org-type">Object</span>&gt; <span class="org-variable-name">lst</span> = session.selectList(<span class="org-string">"findAllLimit"</span>, 1);
    <span class="org-type">RowBounds</span> <span class="org-variable-name">rowBounds</span> = <span class="org-keyword">new</span> <span class="org-type">RowBounds</span>(2, 3);
    <span class="org-type">List</span>&lt;<span class="org-type">Object</span>&gt; <span class="org-variable-name">lst</span> = session.selectList(<span class="org-string">"findAll"</span>, <span class="org-constant">null</span>, rowBounds);
    lst.forEach(System.out::println);

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#32467;&#26524;&#23553;&#35013;&#20026; ResultMap</span>
    <span class="org-type">Map</span>&lt;<span class="org-type">Object</span>, <span class="org-type">Object</span>&gt; <span class="org-variable-name">map</span> = session.selectMap(<span class="org-string">"findAll"</span>, <span class="org-constant">null</span>, <span class="org-string">"name"</span>, <span class="org-keyword">new</span> <span class="org-type">RowBounds</span>(0, 2));
    System.out.println(map);
    System.out.println(map.get(<span class="org-string">"&#40065;&#36805;"</span>));

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#32467;&#26524;&#23553;&#35013;&#20026; Cursor&#65292;&#31867;&#20284; ResultSet &#36941;&#21382;&#30340;&#35821;&#27861;</span>
    <span class="org-type">Cursor</span>&lt;<span class="org-type">Object</span>&gt; <span class="org-variable-name">cs</span> = session.selectCursor(<span class="org-string">"findAll"</span>);
    <span class="org-type">Iterator</span>&lt;<span class="org-type">Object</span>&gt; <span class="org-variable-name">iterator</span> = cs.iterator();
    <span class="org-keyword">while</span> (iterator.hasNext()) {
        System.out.println(iterator.next());
    }

    <span class="org-comment-delimiter">// </span><span class="org-comment">select&#65292;&#36890;&#36807;&#22238;&#35843;&#30340;&#26041;&#24335;&#65292;&#22788;&#29702;&#36820;&#22238;&#32467;&#26524;</span>
    session.select(<span class="org-string">"findAll"</span>, <span class="org-keyword">new</span> <span class="org-type">ResultHandler</span>() {
            <span class="org-c-annotation">@Override</span>
            <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">handleResult</span>(<span class="org-type">ResultContext</span> <span class="org-variable-name">resultContext</span>) {
                <span class="org-keyword">if</span> (resultContext.getResultCount() % 2 == 0)
                    System.out.println(<span class="org-string">"&gt;&gt;&gt;&gt; "</span> + resultContext.getResultCount() + <span class="org-string">" : "</span> + resultContext.getResultObject());
            }
        });

    <span class="org-comment-delimiter">// </span><span class="org-comment">Mapper&#65292;&#26356;&#36890;&#29992;&#65292;&#26356;&#26041;&#20415;&#30340;&#26041;&#24335;</span>
    <span class="org-type">CommonDAO</span> <span class="org-variable-name">mapper</span> = session.getMapper(CommonDAO.<span class="org-keyword">class</span>);
    <span class="org-type">List</span>&lt;<span class="org-type">Author</span>&gt; <span class="org-variable-name">authors</span> = mapper.findAll(<span class="org-keyword">new</span> <span class="org-type">RowBounds</span>(1, 3));
    authors.forEach(System.out::println);

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#21487;&#20197;&#36890;&#36807;&#27880;&#35299;&#30340;&#26041;&#24335;&#20256;&#20837;&#22810;&#21442;&#25968;</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">&#20351;&#29992; RowBounds &#31867;&#22411;&#30340;&#21442;&#25968;&#65292;&#34920;&#31034;&#20998;&#39029;</span>
    <span class="org-type">List</span>&lt;<span class="org-type">Author</span>&gt; <span class="org-variable-name">authors1</span> = mapper.findAllIdBiggerThan(3, <span class="org-keyword">new</span> <span class="org-type">RowBounds</span>(1, 2));
    authors1.forEach(System.out::println);
}
</pre>
</div>
</div>
</section>

<section id="outline-container-orgedb8f02" class="outline-2">
<h2 id="orgedb8f02"><span class="section-number-2">5</span> 示例表</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">sss_author</span> (
       id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
       <span class="org-keyword">name</span> <span class="org-type">varchar</span>(30),
       city <span class="org-type">varchar</span>(30));
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">sss_blog</span> (
       id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
       title <span class="org-type">varchar</span>(30),
       content text,
       author_id <span class="org-type">int</span>);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">sss_comment</span> (
       id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
       body <span class="org-type">varchar</span>(30),
       blog_id <span class="org-type">int</span>,
       author_id <span class="org-type">int</span>);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss_author (<span class="org-keyword">name</span>, city) <span class="org-keyword">values</span>
       (<span class="org-string">'&#37101;&#25964;&#26126;'</span>, <span class="org-string">'&#19978;&#28023;'</span>),
       (<span class="org-string">'&#40065;&#36805;'</span>, <span class="org-string">'&#27993;&#27743;'</span>),
       (<span class="org-string">'&#27611;&#27901;&#19996;'</span>, <span class="org-string">'&#28246;&#21335;'</span>),
       (<span class="org-string">'&#21608;&#31435;&#27874;'</span>, <span class="org-string">'&#19978;&#28023;'</span>),
       (<span class="org-string">'&#21608;&#24681;&#26469;'</span>, <span class="org-string">'&#27993;&#27743;'</span>),
       (<span class="org-string">'&#29579;&#38451;&#26126;'</span>, <span class="org-string">'&#27743;&#35199;'</span>);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss_blog (title, content, author_id) <span class="org-keyword">values</span>
       (<span class="org-string">'&#21584;&#21898;'</span>,<span class="org-string">'&#37266;&#37266;&#21543;&#65292;&#23401;&#23376;'</span>, 2),
       (<span class="org-string">'&#26397;&#33457;&#22805;&#25342;'</span>, <span class="org-string">'&#19977;&#21619;&#20070;&#23627;'</span>, 2),
       (<span class="org-string">'&#32780;&#24050;&#38598;'</span>, <span class="org-string">'&#33485;&#34631;&#23601;&#26159;&#33485;&#34631;'</span>, 2),
       (<span class="org-string">'&#23567;&#26102;&#20195;'</span>, <span class="org-string">'&#24754;&#20260;&#23612;&#31108;&#30475;&#35265;&#30475;&#35265;&#26694;&#26550;'</span>, 1);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss_comment (body, blog_id, author_id) <span class="org-keyword">values</span>
       (<span class="org-string">'&#36825;&#26159;&#19968;&#26412;&#22909;&#20070;&#65292;&#25105;&#26159;&#20889;&#19981;&#20986;&#26469;'</span>, 1, 1),
       (<span class="org-string">'&#24456;&#22909;&#65292;&#24050;&#38405;&#12290;'</span>, 1, 2);

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> sss_blog;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> sss_author;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> sss_comment;

</pre>
</div>
</div>
</section>
<section id="outline-container-org80db176" class="outline-2">
<h2 id="org80db176"><span class="section-number-2">6</span> 任务指导手册 P58 答案参考</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org3bbd286" class="outline-3">
<h3 id="org3bbd286"><span class="section-number-3">6.1</span> 首先，在数据库中创建表，并插入测试数据:</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">customer</span>(
    customer_id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
    first_name <span class="org-type">varchar</span>(30),
    last_name <span class="org-type">varchar</span>(10),
    company <span class="org-type">varchar</span>(30),
    address <span class="org-type">varchar</span>(30),
    city <span class="org-type">varchar</span>(20),
    <span class="org-keyword">state</span> <span class="org-type">varchar</span>(10),
    county <span class="org-type">varchar</span>(10),
    postal_code <span class="org-type">varchar</span>(30),
    phone <span class="org-type">varchar</span>(20),
    fax <span class="org-type">varchar</span>(20),
    email <span class="org-type">varchar</span>(20),
    support_repId <span class="org-type">int</span>
);
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">invoice</span>(
    invoice_id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
    customer_id <span class="org-type">int</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
    invoice_date <span class="org-type">date</span>,
    billing_address <span class="org-type">varchar</span>(20),
    billing_city <span class="org-type">varchar</span>(20),
    billing_state <span class="org-type">varchar</span>(10),
    billing_country <span class="org-type">varchar</span>(20),
    billing_postalCode <span class="org-type">varchar</span>(20),
    total <span class="org-type">int</span>
);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> customer (first_name,last_name,company,address,city,<span class="org-keyword">state</span> ,county,postal_code,phone,fax,email,support_repId)
   <span class="org-keyword">values</span>
   (<span class="org-string">'&#24503;&#21326;'</span>,<span class="org-string">'&#21016;'</span>,<span class="org-string">'&#21271;&#24433;'</span>,<span class="org-string">'001&#21495;&#34903;'</span>,<span class="org-string">'&#39321;&#28207;'</span>,<span class="org-string">'&#20122;&#27954;'</span>,<span class="org-string">'&#20013;&#22269;'</span>,<span class="org-string">'999077'</span>,<span class="org-string">'13842344532'</span>,<span class="org-string">'13842344532'</span>,<span class="org-string">'4534123124@qq.com'</span>,0),
   (<span class="org-string">'&#23500;&#22478;'</span>,<span class="org-string">'&#37101;'</span>,<span class="org-string">'&#21271;&#24433;'</span>,<span class="org-string">'002&#21495;&#34903;'</span>,<span class="org-string">'&#39321;&#28207;'</span>,<span class="org-string">'&#20122;&#27954;'</span>,<span class="org-string">'&#20013;&#22269;'</span>,<span class="org-string">'999077'</span>,<span class="org-string">'15072349132'</span>,<span class="org-string">'15072349132'</span>,<span class="org-string">'8937120154@qq.com'</span>,0),
   (<span class="org-string">'&#40857;'</span>,<span class="org-string">'&#25104;'</span>,<span class="org-string">'&#21271;&#24433;'</span>,<span class="org-string">'003&#21495;&#34903;'</span>,<span class="org-string">'&#39321;&#28207;'</span>,<span class="org-string">'&#20122;&#27954;'</span>,<span class="org-string">'&#20013;&#22269;'</span>,<span class="org-string">'999077'</span>,<span class="org-string">'13389344576'</span>,<span class="org-string">'13389344576'</span>,<span class="org-string">'4534123124@qq.com'</span>,0);

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> invoice (customer_id,invoice_date,billing_address,billing_city, billing_state,billing_country,billing_postalCode,total)
   <span class="org-keyword">values</span>
   (1,<span class="org-string">'2018-10-13'</span>,<span class="org-string">'001&#34903;'</span>,<span class="org-string">'&#39321;&#28207;'</span>,<span class="org-string">'&#20122;&#27954;'</span>,<span class="org-string">'&#20013;&#22269;'</span>,<span class="org-string">'999077'</span>,1);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf022c2" class="outline-3">
<h3 id="orgdf022c2"><span class="section-number-3">6.2</span> 其次，为表创建相应实体类:</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>注意，处理好依赖关系</li>
<li>注意命名规范</li>
<li>要先确定好各种属性，再去生成 setters/getters</li>
</ul>
</div>
</div>

<div id="outline-container-org7dcda7a" class="outline-3">
<h3 id="org7dcda7a"><span class="section-number-3">6.3</span> 然后，创建接口。按照需求，我们要实现两个方法:</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">InvoiceMapper</span> {
    <span class="org-type">Invoice</span> <span class="org-function-name">getInvoiceById</span>(<span class="org-type">int</span> <span class="org-variable-name">id</span>);
    <span class="org-type">Customer</span> <span class="org-function-name">getCustomerById</span>(<span class="org-type">int</span> <span class="org-variable-name">id</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org0c2f814" class="outline-3">
<h3 id="org0c2f814"><span class="section-number-3">6.4</span> 为上述接口，写测试方法:</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AppTest</span> {
    <span class="org-keyword">static</span> <span class="org-type">SqlSessionFactory</span> <span class="org-variable-name">factory</span>;
    <span class="org-keyword">static</span> <span class="org-type">SqlSession</span> <span class="org-variable-name">session</span>;

    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">testGetInvoiceById</span>() {
        <span class="org-type">InvoiceMapper</span> <span class="org-variable-name">mapper</span> = session.getMapper(InvoiceMapper.<span class="org-keyword">class</span>);
        <span class="org-type">Invoice</span> <span class="org-variable-name">invoice</span> = mapper.getInvoiceById(1);
        System.out.println(invoice);
    }

    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">testGetCustomerById</span>() {
        <span class="org-type">InvoiceMapper</span> <span class="org-variable-name">mapper</span> = session.getMapper(InvoiceMapper.<span class="org-keyword">class</span>);
        <span class="org-type">Customer</span> <span class="org-variable-name">customer</span> = mapper.getCustomerById(1);
        System.out.println(customer.getInvoices());
        System.out.println(customer);
    }

    <span class="org-c-annotation">@BeforeClass</span>
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">init</span> () <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">InputStream</span> <span class="org-variable-name">in</span> = Resources.getResourceAsStream(<span class="org-string">"mybatis-config.xml"</span>);
        factory = <span class="org-keyword">new</span> <span class="org-type">SqlSessionFactoryBuilder</span>().build(in);
        session = factory.openSession();
    }

    <span class="org-c-annotation">@AfterClass</span>
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">destroy</span>() {
        session.close();
    }
}
</pre>
</div>

<p>
然后，就可以写接口实现了(Mapper.xml)。
</p>
</div>
</div>

<div id="outline-container-orge9a53da" class="outline-3">
<h3 id="orge9a53da"><span class="section-number-3">6.5</span> Mapper 的第一种方式，Nested ResultMap:</h3>
<div class="outline-text-3" id="text-6-5">
<p>
嵌套的 ResultMap。
</p>

<p>
优点:
</p>
<ul class="org-ul">
<li>xx</li>
<li>yy</li>
</ul>

<p>
缺点:
</p>
<ul class="org-ul">
<li>aa</li>
<li>bb</li>
</ul>

<div class="org-src-container">
<pre class="src src-sgml">&lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmInvoice"</span> <span class="org-variable-name">type</span>=<span class="org-string">"invoice"</span> <span class="org-variable-name">autoMapping</span>=<span class="org-string">"true"</span>&gt;
    &lt;<span class="org-function-name">association</span> <span class="org-variable-name">property</span>=<span class="org-string">"customer"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmCustormer"</span> /&gt;
    &lt;<span class="org-function-name">association</span> <span class="org-variable-name">property</span>=<span class="org-string">"billingInfo"</span> <span class="org-variable-name">javaType</span>=<span class="org-string">"billingInfo"</span> <span class="org-variable-name">autoMapping</span>=<span class="org-string">"true"</span> <span class="org-variable-name">columnPrefix</span>=<span class="org-string">"billing_"</span> /&gt;
&lt;/<span class="org-function-name">resultMap</span>&gt;

&lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmCustormer"</span> <span class="org-variable-name">type</span>=<span class="org-string">"customer"</span> <span class="org-variable-name">autoMapping</span>=<span class="org-string">"true"</span>&gt;
    &lt;<span class="org-function-name">collection</span> <span class="org-variable-name">property</span>=<span class="org-string">"invoices"</span> <span class="org-variable-name">ofType</span>=<span class="org-string">"invoice"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmInvoice"</span> /&gt;
&lt;/<span class="org-function-name">resultMap</span>&gt;

&lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"getInvoiceById"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmInvoice"</span>&gt;
    select
      i.invoice_id,
      i.invoice_date,
      i.billing_address,
      i.billing_city,
      i.billing_state,
      i.billing_country,
      i.billing_postalCode,
      i.total,
      c.*
    from invoice i
     left join customer c on i.customer_id = c.customer_id
     where invoice_id = #{id}
&lt;/<span class="org-function-name">select</span>&gt;

&lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"getCustomerById"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmCustormer"</span>&gt;
    select
      c.*,
      i.invoice_id,
      i.invoice_date,
      i.billing_address,
      i.billing_city,
      i.billing_state,
      i.billing_country,
      i.billing_postalcode,
      i.total
    from customer c
    left join invoice i on i.customer_id = c.customer_id
    where c.customer_id = #{id}
&lt;/<span class="org-function-name">select</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org894073d" class="outline-3">
<h3 id="org894073d"><span class="section-number-3">6.6</span> Mapper 的第二种方式，Nested Select:</h3>
<div class="outline-text-3" id="text-6-6">
<p>
嵌套的 Select 查询。
</p>

<p>
优点:
</p>
<ul class="org-ul">
<li>xx</li>
<li>yy</li>
</ul>

<p>
缺点:
</p>
<ul class="org-ul">
<li>aa</li>
<li>bb</li>
</ul>

<div class="org-src-container">
<pre class="src src-sgml">&lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmInvoice"</span> <span class="org-variable-name">type</span>=<span class="org-string">"invoice"</span> <span class="org-variable-name">autoMapping</span>=<span class="org-string">"true"</span>&gt;
    &lt;<span class="org-function-name">association</span> <span class="org-variable-name">property</span>=<span class="org-string">"customer"</span> <span class="org-variable-name">column</span>=<span class="org-string">"customer_id"</span> <span class="org-variable-name">select</span>=<span class="org-string">"getCustomerById"</span> /&gt;
    &lt;<span class="org-function-name">association</span> <span class="org-variable-name">property</span>=<span class="org-string">"billingInfo"</span> <span class="org-variable-name">javaType</span>=<span class="org-string">"billingInfo"</span> <span class="org-variable-name">columnPrefix</span>=<span class="org-string">"billing_"</span> <span class="org-variable-name">autoMapping</span>=<span class="org-string">"true"</span> /&gt;
&lt;/<span class="org-function-name">resultMap</span>&gt;

&lt;<span class="org-function-name">resultMap</span> <span class="org-variable-name">id</span>=<span class="org-string">"rmCustomer"</span> <span class="org-variable-name">type</span>=<span class="org-string">"customer"</span> <span class="org-variable-name">autoMapping</span>=<span class="org-string">"true"</span>&gt;
    &lt;<span class="org-function-name">collection</span> <span class="org-variable-name">property</span>=<span class="org-string">"invoices"</span> <span class="org-variable-name">ofType</span>=<span class="org-string">"invoice"</span>
                <span class="org-variable-name">column</span>=<span class="org-string">"customer_id"</span> <span class="org-variable-name">select</span>=<span class="org-string">"getInvoiceByCustomerId"</span> /&gt;
&lt;/<span class="org-function-name">resultMap</span>&gt;

&lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"getInvoiceById"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmInvoice"</span>&gt;
    select * from invoice
&lt;/<span class="org-function-name">select</span>&gt;

&lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"getCustomerById"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmCustomer"</span>&gt;
    select * from customer where customer_id = #{id}
&lt;/<span class="org-function-name">select</span>&gt;

&lt;<span class="org-function-name">select</span> <span class="org-variable-name">id</span>=<span class="org-string">"getInvoiceByCustomerId"</span> <span class="org-variable-name">resultMap</span>=<span class="org-string">"rmInvoice"</span>&gt;
    select * from invoice where customer_id = #{id}
&lt;/<span class="org-function-name">select</span>&gt;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org2070eee" class="outline-2">
<h2 id="org2070eee"><span class="section-number-2">7</span> 缓存 (Cache)</h2>
<div class="outline-text-2" id="text-7">
<p>
缓存类型:
</p>
<ul class="org-ul">
<li>一级缓存</li>
<li>二级缓存</li>
</ul>

<p>
缓存的配置与使用。
</p>
</div>
</section>

<section id="outline-container-org4851433" class="outline-2">
<h2 id="org4851433"><span class="section-number-2">8</span> 分页 (Pagination)</h2>
<div class="outline-text-2" id="text-8">
<p>
分页方式的分类:
</p>
<ul class="org-ul">
<li>逻辑分页</li>
<li>物理分页</li>
</ul>

<p>
分页的实现原理。
</p>

<p>
MyBatis-PageHelper 的使用:
</p>
<ul class="org-ul">
<li><a href="https://github.com/pagehelper/Mybatis-PageHelper">https://github.com/pagehelper/Mybatis-PageHelper</a></li>
</ul>
</div>
</section>

<section id="outline-container-orgd61a2c2" class="outline-2">
<h2 id="orgd61a2c2"><span class="section-number-2">9</span> MBG (MyBatis-Generator)</h2>
<div class="outline-text-2" id="text-9">
<p>
<a href="http://www.mybatis.org/generator/">http://www.mybatis.org/generator/</a>
</p>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 某某人</p>
<p class="date">Created: 2018-10-17 周三 08:03</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
