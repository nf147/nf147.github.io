<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-10-12 Fri 02:02 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MyBatis</title>
<meta name="generator" content="Org mode">
<meta name="author" content="某某人">
<link rel='stylesheet' href='/asset/common.css' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">MyBatis</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc7e8118">1. 历史背景</a>
<ul>
<li><a href="#orgcfdcc5f">1.1. 背景</a></li>
<li><a href="#orga2a5e72">1.2. Hibernate</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-orgc7e8118" class="outline-2">
<h2 id="orgc7e8118"><span class="section-number-2">1</span> 历史背景</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgcfdcc5f" class="outline-3">
<h3 id="orgcfdcc5f"><span class="section-number-3">1.1</span> 背景</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>SSH, Spring + Struts1,2 + Hibernate</li>
<li>SSM, Spring + SpringMVC + MyBatis</li>
</ul>

<p>
dao, 数据库连接
</p>

<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> (id <span class="org-type">int</span> auto_increment <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> <span class="org-type">varchar</span>(20), weixin <span class="org-type">varchar</span>(20));
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person (<span class="org-keyword">name</span>, weixin) <span class="org-keyword">values</span> (<span class="org-string">'&#24352;&#23398;&#21451;'</span>, <span class="org-string">'110'</span>), (<span class="org-string">'&#21016;&#20134;&#33778;'</span>, <span class="org-string">'220'</span>);
</pre>
</div>

<p>
jdbc:
</p>
<ul class="org-ul">
<li>自行管理连接，语法比较繁琐</li>
<li>容易写出不健壮的代码</li>
<li>容易忽略业务逻辑</li>
</ul>

<p>
ORM:
</p>
<ul class="org-ul">
<li>Object-Relational Mapping</li>
</ul>


<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Person</span> {
    <span class="org-keyword">private</span> <span class="org-type">int</span> <span class="org-variable-name">id</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">name</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">weixin</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">getter..setter</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orga2a5e72" class="outline-3">
<h3 id="orga2a5e72"><span class="section-number-3">1.2</span> Hibernate</h3>
<div class="outline-text-3" id="text-1-2">
<p>
想法:
</p>
<ol class="org-ol">
<li>助手，读取数据库，获取相关的类，建立一种映射关系。session</li>
<li><p>
使用助手操作数据库:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-type">Book</span> <span class="org-variable-name">book</span> = <span class="org-keyword">new</span> <span class="org-type">Book</span>(<span class="org-string">"hhhh"</span>, 222);
session.save(book);

<span class="org-type">Book</span> <span class="org-variable-name">book1</span> = session.get(2L, Book.<span class="org-keyword">class</span>);
System.out.println(book1.getName());
</pre>
</div></li>
</ol>

<p>
示例，首先，在项目中添加依赖:
</p>
<div class="org-src-container">
<pre class="src src-sgml">&lt;<span class="org-function-name">dependency</span>&gt;
  &lt;<span class="org-function-name">groupId</span>&gt;org.hibernate&lt;/<span class="org-function-name">groupId</span>&gt;
  &lt;<span class="org-function-name">artifactId</span>&gt;hibernate-core&lt;/<span class="org-function-name">artifactId</span>&gt;
  &lt;<span class="org-function-name">version</span>&gt;5.3.6.Final&lt;/<span class="org-function-name">version</span>&gt;
&lt;/<span class="org-function-name">dependency</span>&gt;

&lt;<span class="org-function-name">dependency</span>&gt;
  &lt;<span class="org-function-name">groupId</span>&gt;org.mariadb.jdbc&lt;/<span class="org-function-name">groupId</span>&gt;
  &lt;<span class="org-function-name">artifactId</span>&gt;mariadb-java-client&lt;/<span class="org-function-name">artifactId</span>&gt;
  &lt;<span class="org-function-name">version</span>&gt;2.3.0&lt;/<span class="org-function-name">version</span>&gt;
&lt;/<span class="org-function-name">dependency</span>&gt;
</pre>
</div>

<p>
其次，创建配置文件 hibernate.cfg.xml:
</p>
<div class="org-src-container">
<pre class="src src-sgml"><span class="org-string">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span>
<span class="org-string">&lt;!DOCTYPE hibernate-configuration PUBLIC</span>
<span class="org-string"> "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
<span class="org-string"> "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;</span>

&lt;<span class="org-function-name">hibernate-configuration</span>&gt;
  &lt;<span class="org-function-name">session-factory</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.driver_class"</span>&gt;org.mariadb.jdbc.Driver&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.url"</span>&gt;jdbc:mariadb://localhost:3306/lagou&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.username"</span>&gt;vip&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.connection.password"</span>&gt;vip&lt;/<span class="org-function-name">property</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.dialect"</span>&gt;org.hibernate.dialect.MariaDB10Dialect&lt;/<span class="org-function-name">property</span>&gt;

    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"hibernate.show_sql"</span>&gt;true&lt;/<span class="org-function-name">property</span>&gt;

    &lt;<span class="org-function-name">mapping</span> <span class="org-variable-name">class</span>=<span class="org-string">"com.nf147.sss.entity.Person"</span> /&gt;
  &lt;/<span class="org-function-name">session-factory</span>&gt;
&lt;/<span class="org-function-name">hibernate-configuration</span>&gt;
</pre>
</div>

<p>
然后，创建 entity:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Entity</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Person</span> {
    <span class="org-c-annotation">@Id</span>
    <span class="org-c-annotation">@GeneratedValue</span>(strategy = <span class="org-constant">GenerationType</span>.IDENTITY)
    <span class="org-keyword">private</span> <span class="org-type">Long</span> <span class="org-variable-name">id</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">name</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">weixin</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">getter..setter</span>
}
</pre>
</div>

<p>
之后，就可以使用了:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>( <span class="org-type">String</span>[] <span class="org-variable-name">args</span> )
{
    <span class="org-type">Configuration</span> <span class="org-variable-name">configuration</span> = <span class="org-keyword">new</span> <span class="org-type">Configuration</span>();
    <span class="org-type">Configuration</span> <span class="org-variable-name">configure</span> = configuration.configure(<span class="org-string">"hibernate.cfg.xml"</span>);
    <span class="org-type">SessionFactory</span> <span class="org-variable-name">sessionFactory</span> = configuration.buildSessionFactory();

    <span class="org-type">Session</span> <span class="org-variable-name">session</span> = sessionFactory.openSession();
    <span class="org-type">Person</span> <span class="org-variable-name">person</span> = session.get(Person.<span class="org-keyword">class</span>, 1L);
    System.out.println(person.getName());

    System.out.println(session.get(Person.<span class="org-keyword">class</span>, 2L).getName());

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#26032;&#22686;</span>
    <span class="org-type">Person</span> <span class="org-variable-name">fbb</span> = <span class="org-keyword">new</span> <span class="org-type">Person</span>();
    fbb.setName(<span class="org-string">"fanbingbing"</span>);
    fbb.setWeixin(<span class="org-string">"80000000000"</span>);
    session.save(fbb);

    session.close();
    sessionFactory.close();
}
</pre>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 某某人</p>
<p class="date">Created: 2018-10-12 Fri 02:02</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
