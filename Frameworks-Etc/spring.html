<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-12-13 Thu 06:40 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spring Framework</title>
<meta name="generator" content="Org mode">
<meta name="author" content="孙悟空">
<link rel='stylesheet' href='/asset/common.css' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Spring Framework</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org647e25c">1. vs. 工厂模式</a></li>
<li><a href="#orgbedddb2">2. 接口</a></li>
<li><a href="#org64d7018">3. 配置</a>
<ul>
<li><a href="#orgacd61ef">3.1. 传统的方式 xml</a></li>
<li><a href="#orgdaf4698">3.2. 基于 Java 的方式进行配置</a></li>
<li><a href="#orgc89bd36">3.3. 混合双打</a></li>
</ul>
</li>
<li><a href="#orgbfc911f">4. 装配 (Wiring)</a>
<ul>
<li><a href="#org04c06e1">4.1. Wiring in XML</a></li>
<li><a href="#org4d36aa6">4.2. Wiring in JavaConfig</a></li>
<li><a href="#org580d7b1">4.3. Wiring with Annotation</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-org647e25c" class="outline-2">
<h2 id="org647e25c"><span class="section-number-2">1</span> vs. 工厂模式</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">ServiceFactory</span> {
    <span class="org-keyword">public</span> <span class="org-type">Object</span> <span class="org-function-name">getServiceObject</span> (<span class="org-type">String</span> <span class="org-variable-name">name</span>) {
        <span class="org-keyword">if</span> (name.equals(<span class="org-string">"bs"</span>)) {
            <span class="org-type">A</span> <span class="org-variable-name">a</span> = <span class="org-keyword">new</span> <span class="org-type">A</span>();
            <span class="org-type">B</span> <span class="org-variable-name">b</span> = <span class="org-keyword">new</span> <span class="org-type">B</span>(a); <span class="org-comment-delimiter">// </span><span class="org-comment">&#26500;&#36896;&#22120;</span>
            <span class="org-type">MyBatiscConnection</span> <span class="org-variable-name">conn</span> = <span class="org-keyword">new</span> <span class="org-type">MyBatiscConnection</span>();
            <span class="org-type">LogUtil</span> <span class="org-variable-name">log</span> = <span class="org-keyword">new</span> <span class="org-type">LogUtil</span>();
            <span class="org-type">BookService</span> <span class="org-variable-name">bookservice</span> = <span class="org-keyword">new</span> <span class="org-type">BookService</span>();

            b.setA(a); <span class="org-comment-delimiter">// </span><span class="org-comment">setter</span>
            conn.setB(b);
            bookservice.setConn(conn);
            LogUtil.setConn(conn);
            bookservice.setLogger(log);

            <span class="org-keyword">return</span> bookservice;
        }
    }
}

<span class="org-function-name">main</span> () {
    <span class="org-type">ServiceFactory</span> <span class="org-variable-name">sf</span> = <span class="org-keyword">new</span> <span class="org-type">ServiceFactory</span>();

    <span class="org-type">BookService</span> <span class="org-variable-name">bookservice</span> = sf.getServiceObject(<span class="org-string">"bs"</span>);
    bookservice.sellBook();
}
</pre>
</div>

<p>
将工厂模式切割，分为解析程序和 xml 文件。
</p>

<p>
xml 暴露出来，用来<b>描述</b>工厂需要实例化的类以及他们之间的关系。
</p>

<div class="org-src-container">
<pre class="src src-sgml">&lt;<span class="org-function-name">xml</span>&gt;
  <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#20043;&#21069;&#21629;&#20196;&#65307;&#25551;&#36848; </span><span class="org-comment-delimiter">--&gt;</span>
  &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"a"</span> <span class="org-variable-name">class</span>=<span class="org-string">"xxx.yyy.A"</span> /&gt;
  &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"b"</span> <span class="org-variable-name">class</span>=<span class="org-string">"xxx.yyy.B"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"a"</span> <span class="org-variable-name">bean</span>=<span class="org-string">"a"</span> /&gt;
  &lt;/<span class="org-function-name">bean</span>&gt;
  &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"conn"</span> <span class="org-variable-name">class</span>=<span class="org-string">"xxx.yyy.MyBConn"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"b"</span> <span class="org-variable-name">bean</span>=<span class="org-string">"b"</span> /&gt;
  &lt;/<span class="org-function-name">bean</span>&gt;
  &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"log"</span> <span class="org-variable-name">class</span>=<span class="org-string">"xxx.yyy.LogUtil"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"conn"</span> <span class="org-variable-name">bean</span>=<span class="org-string">"conn"</span> /&gt;
  &lt;/<span class="org-function-name">bean</span>&gt;
  &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"bookservice"</span> <span class="org-variable-name">class</span>=<span class="org-string">"xxx.BookService"</span>&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"conn"</span> <span class="org-variable-name">bean</span>=<span class="org-string">"conn"</span> /&gt;
    &lt;<span class="org-function-name">property</span> <span class="org-variable-name">name</span>=<span class="org-string">"log"</span> <span class="org-variable-name">bean</span>=<span class="org-string">"log"</span> /&gt;
  &lt;/<span class="org-function-name">bean</span>&gt;
&lt;/<span class="org-function-name">xml</span>&gt;
</pre>
</div>
</div>
</section>

<section id="outline-container-orgbedddb2" class="outline-2">
<h2 id="orgbedddb2"><span class="section-number-2">2</span> 接口</h2>
<div class="outline-text-2" id="text-2">
<p>
最核心的 jar 包:
</p>
<ul class="org-ul">
<li>spring-core</li>
<li>spring-bean</li>
<li>spring-context</li>
</ul>

<p>
最核心的接口是 <code>BeanFactory</code>，它用来描述 IOC 容器:
</p>


<figure>
<img src="img/clip_2018-12-13_03-01-52.png" alt="clip_2018-12-13_03-01-52.png">

</figure>

<p>
它很干净，很纯粹，最主要的方法是 <code>getBean</code> 用来给调用方返回一个实例化好的对象。
</p>

<p>
在实际运用中，需要一些周边功能，比如加载资源/国际化/等等，Spring 为此提供了 <code>ApplicatinContext</code>
接口。它本身是 BeanFactory 的一个实现:
</p>


<figure>
<img src="img/clip_2018-12-13_03-04-54.png" alt="clip_2018-12-13_03-04-54.png">

</figure>

<p>
可以看到，ApplicationContext 除了实现了 BeanFactory，还实现了其他一些实用的接口。因此，它是在 Spring 中操作一切的核心。
</p>

<p>
这是<b>门面模式</b>的一种典型使用。
</p>
</div>
</section>


<section id="outline-container-org64d7018" class="outline-2">
<h2 id="org64d7018"><span class="section-number-2">3</span> 配置</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgacd61ef" class="outline-3">
<h3 id="orgacd61ef"><span class="section-number-3">3.1</span> 传统的方式 xml</h3>
<div class="outline-text-3" id="text-3-1">
<p>
这种方式，充分利用了 xml 文件的优势:
</p>
<ul class="org-ul">
<li>接受度比较高，语法简单</li>
<li>表达能力比较强</li>
<li>生态比较完整，基于 xml 的校验、解析等比较完善</li>
</ul>

<p>
所以，最开始的时候，描述工厂里 bean 声明的方式，选用的就是 xml
</p>

<div class="org-src-container">
<pre class="src src-sgml"><span class="org-string">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
&lt;<span class="org-function-name">beans</span> <span class="org-variable-name">xmlns</span>=<span class="org-string">"http://www.springframework.org/schema/beans"</span>
       <span class="org-sgml-namespace">xmlns</span>:<span class="org-variable-name">xsi</span>=<span class="org-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="org-sgml-namespace">xsi</span>:<span class="org-variable-name">schemaLocation</span>=<span class="org-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;

    &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"bs1"</span> <span class="org-variable-name">class</span>=<span class="org-string">"learning.spring.BookServiceImpl"</span> /&gt;
    &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"bs2"</span> <span class="org-variable-name">class</span>=<span class="org-string">"learning.spring.BookService2Impl"</span> /&gt;

    <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;bean id="bs2" class="learning.spring.BookServiceImplImpl" /&gt;</span><span class="org-comment-delimiter">--&gt;</span>

    <span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">&lt;bean id="bs3" class="learning.spring.BookServiceImplImpl" /&gt;</span><span class="org-comment-delimiter">--&gt;</span>
&lt;/<span class="org-function-name">beans</span>&gt;
</pre>
</div>

<p>
但是:
</p>
<ul class="org-ul">
<li>很多人不喜欢 xml 这种标签式的语法。写起来麻烦，看起来不舒服</li>
<li>xml 方式过于重型</li>
<li>xml 语法校验虽然强大，但不够强大</li>
<li>xml 虽然灵活，但不够灵活</li>
</ul>

<p>
所以，就产生了很多其他的叛逆的想法
</p>
</div>
</div>

<div id="outline-container-orgdaf4698" class="outline-3">
<h3 id="orgdaf4698"><span class="section-number-3">3.2</span> 基于 Java 的方式进行配置</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Configuration</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SuibianSpringConfig</span> {

    <span class="org-comment-delimiter">// </span><span class="org-comment">&lt;bean id="bs1" class="learning.spring.BookServiceImpl" /&gt;</span>
    <span class="org-c-annotation">@Bean</span>
    <span class="org-keyword">public</span> <span class="org-type">BookService</span> <span class="org-function-name">bs1</span>() {
        <span class="org-keyword">if</span> (Math.random() &gt; 0.5) {
            <span class="org-comment-delimiter">// </span><span class="org-comment">&#26500;&#36896;&#22120;&#27880;&#20837;</span>
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">BookService2Impl</span>(bookDAO());
        } <span class="org-keyword">else</span> {
            <span class="org-comment-delimiter">// </span><span class="org-comment">setter &#27880;&#20837;</span>
            <span class="org-type">BookService</span> <span class="org-variable-name">bs</span> = <span class="org-keyword">new</span> <span class="org-type">BookServiceImpl</span>();
            bs.setBookDAO(bookDAO());
            <span class="org-keyword">return</span> bs;
        }
    }

    <span class="org-c-annotation">@Bean</span>
    <span class="org-keyword">public</span> <span class="org-type">BookDAO</span> <span class="org-function-name">bookDAO</span> () {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">BookDAO</span>();
    }
}

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc89bd36" class="outline-3">
<h3 id="orgc89bd36"><span class="section-number-3">3.3</span> 混合双打</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Java Style 中混入 XML Style:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Configuration</span>
<span class="org-c-annotation">@ImportResource</span>(locations = <span class="org-string">"learning/spring/my-spring.xml"</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SuibianSpringConfig</span> {

    <span class="org-comment-delimiter">// </span><span class="org-comment">&lt;bean id="bs1" class="learning.spring.BookServiceImpl" /&gt;</span>
    <span class="org-c-annotation">@Bean</span>
    <span class="org-keyword">public</span> <span class="org-type">BookService</span> <span class="org-function-name">bs1</span>() {
        System.out.println(bookDAO());
        <span class="org-keyword">if</span> (Math.random() &gt; 0.5) {
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">BookService2Impl</span>();
        } <span class="org-keyword">else</span> {
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">BookServiceImpl</span>();
        }
    }

    <span class="org-c-annotation">@Bean</span>
    <span class="org-keyword">public</span> <span class="org-type">BookDAO</span> <span class="org-function-name">bookDAO</span> () {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">BookDAO</span>();
    }
}

</pre>
</div>

<p>
XML style 中混入 Java Style:
</p>
<div class="org-src-container">
<pre class="src src-sgml"><span class="org-string">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
&lt;<span class="org-function-name">beans</span> <span class="org-variable-name">xmlns</span>=<span class="org-string">"http://www.springframework.org/schema/beans"</span>
       <span class="org-sgml-namespace">xmlns</span>:<span class="org-variable-name">xsi</span>=<span class="org-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="org-sgml-namespace">xsi</span>:<span class="org-variable-name">schemaLocation</span>=<span class="org-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;

    &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">id</span>=<span class="org-string">"bs2"</span> <span class="org-variable-name">class</span>=<span class="org-string">"learning.spring.BookService2Impl"</span> /&gt;
    &lt;<span class="org-function-name">bean</span> <span class="org-variable-name">class</span>=<span class="org-string">"learning.spring.configuration.SuibianSpringConfig"</span> /&gt;
&lt;/<span class="org-function-name">beans</span>&gt;
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-orgbfc911f" class="outline-2">
<h2 id="orgbfc911f"><span class="section-number-2">4</span> 装配 (Wiring)</h2>
<div class="outline-text-2" id="text-4">
<blockquote>
<p>

</p>

<p>
创建应用对象之间协作关系的行为，通常称为装配 (Wiring)。这是依赖注入 (DI) 的本质。
</p>
</blockquote>

<p>
装配的基础，是使用配置文件对 Bean 的关系进行声明。
</p>

<p>
总结起来，在 Spring 中，声明 Bean 一共有三种方式:
</p>
<ol class="org-ol">
<li>在 XML Style 的配置中，使用 <code>&lt;bean /&gt;</code> 节点</li>
<li>在 Java Style 的配置中，使用 <code>@Bean</code> 注解</li>
<li>开启 Component 扫描，然后使用相关注解: <code>@Component/@Controller/@Service/@Repository</code></li>
</ol>
</div>

<div id="outline-container-org04c06e1" class="outline-3">
<h3 id="org04c06e1"><span class="section-number-3">4.1</span> Wiring in XML</h3>
<div class="outline-text-3" id="text-4-1">
<p>
装配:
</p>
<div class="org-src-container">
<pre class="src src-sgml">
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d36aa6" class="outline-3">
<h3 id="org4d36aa6"><span class="section-number-3">4.2</span> Wiring in JavaConfig</h3>
</div>

<div id="outline-container-org580d7b1" class="outline-3">
<h3 id="org580d7b1"><span class="section-number-3">4.3</span> Wiring with Annotation</h3>
<div class="outline-text-3" id="text-4-3">
<p>
首先，需要开启 Component Scanning，即组件扫描:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">JavaConfig</span>
<span class="org-c-annotation">@Configuration</span>
<span class="org-c-annotation">@ComponentScan</span>(<span class="org-string">"xxx.components"</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SpringConfig</span> {
    <span class="org-comment-delimiter">// </span><span class="org-comment">...</span>
}


<span class="org-comment-delimiter">// </span><span class="org-comment">XMLConfig:</span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">&lt;context:component-scan base-package="xxx.components" /&gt;</span>
</pre>
</div>

<p>
声明 Bean 有四个注解:
</p>
<ol class="org-ol">
<li>@Component</li>
<li>@Controller</li>
<li>@Service</li>
<li>@Repository</li>
</ol>

<p>
在注解的方式中，要确定 Bean 之间的关系，需要使用下面注解进行 “注入”:
</p>
<ul class="org-ul">
<li>@Autowired</li>
<li>@Inject</li>
<li>@Resource</li>
</ul>

<p>
注入的注解：
</p>
<ul class="org-ul">
<li>可以放在 field 上，称作属性注入</li>
<li>可以放在 constructor 上，称作构造器注入</li>
<li>可以放在 setter 方法上，称作 setter 注入</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Controller</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">BookController</span> {
    <span class="org-c-annotation">@Autowired</span> <span class="org-comment-delimiter">// </span><span class="org-comment">&#23646;&#24615;&#27880;&#20837;</span>
    <span class="org-type">BookDAO</span> <span class="org-variable-name">bookDAO</span>;

    <span class="org-c-annotation">@Autowired</span> <span class="org-comment-delimiter">// </span><span class="org-comment">&#26500;&#36896;&#22120;&#27880;&#20837;</span>
    <span class="org-keyword">public</span> <span class="org-function-name">BookController</span>(<span class="org-type">BookDAO</span> <span class="org-variable-name">bookDAO</span>) {
        <span class="org-keyword">this</span>.bookDAO = bookDAO;
    }

    <span class="org-c-annotation">@Autowired</span> <span class="org-comment-delimiter">// </span><span class="org-comment">setter &#27880;&#20837;</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">setBookDAO</span>(<span class="org-type">BookDAO</span> <span class="org-variable-name">bookDAO</span>) {
        <span class="org-keyword">this</span>.bookDAO = bookDAO;
    }
}
</pre>
</div>

<p>
属性注入的写法是最简单的，但不建议使用。原因:
</p>
<ol class="org-ol">
<li>&#x2026;</li>
<li>&#x2026;</li>
<li>&#x2026;</li>
</ol>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 孙悟空</p>
<p class="date">Created: 2018-12-13 Thu 06:40</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
